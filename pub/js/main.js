"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function changeWorkEndState(){this.checked?(document.getElementById("workendyear").setAttribute("disabled",!0),document.getElementById("workendmonth").setAttribute("disabled",!0)):(document.getElementById("workendyear").removeAttribute("disabled"),document.getElementById("workendmonth").removeAttribute("disabled"))}document.getElementById("workongoing").addEventListener("change",changeWorkEndState);var localURL="http://localhost/resume_site/pub/api/education",education=[],deletedId=null,updatedId=null;function changeEducationEndState(){this.checked?(document.getElementById("educationendyear").setAttribute("disabled",!0),document.getElementById("educationendmonth").setAttribute("disabled",!0)):(document.getElementById("educationendyear").removeAttribute("disabled"),document.getElementById("educationendmonth").removeAttribute("disabled"))}function changeUpdatedEducationEndState(){this.checked?(document.getElementById("updateeducationendyear").setAttribute("disabled",!0),document.getElementById("updateeducationendmonth").setAttribute("disabled",!0)):(document.getElementById("updateeducationendyear").removeAttribute("disabled"),document.getElementById("updateeducationendmonth").removeAttribute("disabled"))}function fetchEducation(){document.querySelector("#education tbody").innerHTML="",fetch(localURL,{method:"get"}).then((function(e){return e.json()})).then((function(e){console.log(e),e instanceof Array?(education=_toConsumableArray(e),document.querySelector("#education table").style.display="table",education.forEach((function(e){document.querySelector("#education tbody").innerHTML+='\n                <tr>\n                    <th scope="row">'.concat(e.name,"</th>\n                    <td>").concat(e.school,"</td>\n                    <td>").concat(e.startmonth," ").concat(e.startyear," - ").concat(1==e.ongoing?"pågående":e.endmonth+" "+e.endyear,'</td>\n                    <td>\n                        <button type="button" class="btn btn-info btn-sm" onClick="openUpdateModal(').concat(e.id,')">Uppdatera</button>\n                        <button type="button" class="btn btn-danger btn-sm" onClick="openDeleteModal(').concat(e.id,')">Radera</button>\n                    </td>\n                </tr>\n                ')}))):(document.querySelector("#education table").style.display="none",document.querySelector(".education-card").style.display="block",document.querySelector(".education-card .card-title").textContent=e.message,document.querySelector(".education-card .card-text").textContent="Lägg till ny utbildning.")})).catch((function(e){document.querySelector("#education table").style.display="none",document.querySelector(".education-card").style.display="block",document.querySelector(".education-card .card-title").textContent=e,document.querySelector(".education-card .card-text").textContent="Något gick fel med inladdningen av utbildningar."}))}function addEducation(e){e.preventDefault();var t={},n=document.querySelector("#educationname").value,o=document.querySelector("#educationschool").value,d=document.querySelector("#educationstartyear").value,a=document.querySelector("#educationstartmonth").value,c=document.querySelector("#educationendyear").value,u=document.querySelector("#educationendmonth").value;0!==n.trim().length&&0!==o.trim().length&&0!==d.trim().length&&0!==a.trim().length?(t=document.querySelector("#educationongoing").checked?{name:n,school:o,startyear:d,startmonth:a,ongoing:1,endyear:null,endmonth:null}:{name:n,school:o,startyear:d,startmonth:a,ongoing:0,endyear:c,endmonth:u},fetch(localURL,{method:"post",body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){showMessage(e.class,e.message),clearEducationFields(),fetchEducation()})).catch((function(e){showMessage("education-alert-danger",e)}))):showMessage("education-alert-danger","Fyll i samtliga fält.")}function deleteEducation(){fetch(localURL,{method:"delete",body:JSON.stringify({id:deletedId})}).then((function(e){return e.json()})).then((function(e){showMessage(e.class,e.message),clearEducationFields(),$("#delete-education-modal").modal("hide"),fetchEducation()})).catch((function(e){showMessage("education-alert-danger",e)}))}function updateEducation(e){e.preventDefault();var t=document.querySelector("#updateeducationname").value,n=document.querySelector("#updateeducationschool").value,o=document.querySelector("#updateeducationstartyear").value,d=document.querySelector("#updateeducationstartmonth").value,a=document.querySelector("#updateeducationendyear").value,c=document.querySelector("#updateeducationendmonth").value,u=document.querySelector("#updateeducationongoing").checked;if(0!==t.trim().length&&0!==n.trim().length&&0!==o.trim().length&&0!==d.trim().length)if(!u&&0===a.trim().length&&0===c.trim().length||a.trim().length>0&&0===c.trim().length||c.trim().length>0&&0===a.trim().length)showMessage("update-education-alert-danger","Både slutår och månad måste anges om utbildningen inte är pågående.");else{var r={};r=u?{name:t,school:n,startyear:o,startmonth:d,ongoing:1,endyear:null,endmonth:null,id:updatedId}:{name:t,school:n,startyear:o,startmonth:d,ongoing:0,endyear:a,endmonth:c,id:updatedId},fetch(localURL,{method:"put",body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(e){showMessage(e.class,e.message),clearEducationFields(),$("#update-education-modal").modal("hide"),fetchEducation()})).catch((function(e){showMessage("update-education-alert-danger",e)}))}else showMessage("update-education-alert-danger","Alla fält måste fyllas i.")}function clearEducationFields(){document.querySelector("#educationname").value="",document.querySelector("#educationschool").value="",document.querySelector("#educationstartyear").selectedIndex=0,document.querySelector("#educationstartmonth").selectedIndex=0,document.querySelector("#educationongoing").checked=!1,document.querySelector("#educationendyear").selectedIndex=0,document.querySelector("#educationendmonth").selectedIndex=0}function openUpdateModal(e){$("#update-education-modal").modal({backdrop:!0,keyboard:!0,focus:!0,show:!0}),updatedId=e;var t=education.find((function(t){return t.id==e}));document.querySelector("#updateeducationname").value=t.name,document.querySelector("#updateeducationschool").value=t.school,document.querySelector("#updateeducationstartyear").value=t.startyear,document.querySelector("#updateeducationstartmonth").value=t.startmonth,document.querySelector("#updateeducationendyear").value=t.endyear,document.querySelector("#updateeducationendmonth").value=t.endmonth,document.querySelector("#updateeducationongoing").checked=1==t.ongoing,1==t.ongoing?(document.getElementById("updateeducationendyear").setAttribute("disabled",!0),document.getElementById("updateeducationendmonth").setAttribute("disabled",!0)):(document.getElementById("updateeducationendyear").removeAttribute("disabled"),document.getElementById("updateeducationendmonth").removeAttribute("disabled"))}function openDeleteModal(e){$("#delete-education-modal").modal({backdrop:!0,keyboard:!0,focus:!0,show:!0}),deletedId=e;var t=education.find((function(t){return t.id==e}));document.querySelector("#delete-education-modal .deleted-education-name").innerHTML="<strong>Namn: </strong>".concat(t.name),document.querySelector("#delete-education-modal .deleted-education-school").innerHTML="<strong>Lärosäte: </strong>".concat(t.school),document.querySelector("#delete-education-modal .deleted-education-date").innerHTML="<strong>Tid: </strong>".concat(t.startmonth," ").concat(t.startyear," - ").concat(t.endmonth," ").concat(t.endyear)}function showMessage(e,t){document.querySelector("."+e).style.display="block",document.querySelector("."+e).innerHTML='<button type="button" class="close" data-dismiss="alert">&times;</button>'.concat(t),setTimeout((function(){document.querySelector("."+e).style.display="none"}),4e3)}document.getElementById("educationongoing").addEventListener("change",changeEducationEndState),document.getElementById("updateeducationongoing").addEventListener("change",changeUpdatedEducationEndState),window.addEventListener("load",fetchEducation),document.querySelector(".education-form").addEventListener("submit",addEducation),document.querySelector(".education-delete-btn").addEventListener("click",deleteEducation),document.querySelector(".update-education-form").addEventListener("submit",updateEducation);